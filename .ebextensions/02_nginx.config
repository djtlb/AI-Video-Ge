files:
  "/etc/nginx/conf.d/proxy.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      # IP whitelist configuration
      geo $allowed_ip {
        default 0;
        
        # AWS IPs
        52.41.36.82 1;
        54.191.253.12 1;
        44.226.122.3 1;
        
        # Always allow localhost
        127.0.0.1 1;
        ::1 1;
      }
      
      # Define IP whitelist restrictions
      map $allowed_ip $allow {
        0 0;
        1 1;
      }
      
  "/opt/elasticbeanstalk/hooks/appdeploy/post/99_restart_nginx.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      systemctl restart nginx
      
container_commands:
  01_restart_nginx:
    command: "systemctl restart nginx"
